# ä½¿ç”¨èåˆåçš„ Lightning æ¨¡å‹æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

âœ… å·²è¿è¡Œ `python 3_merge_lora_to_weights.py`  
âœ… èåˆæ¨¡å‹å·²ä¿å­˜åœ¨ï¼š`./models/qwen-image-edit-lightning-merged/`

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **åŸºç¡€ç”¨æ³•ï¼ˆé»˜è®¤å‚æ•°ï¼‰**

```bash
python 4_use_merged_model.py
```

ä½¿ç”¨é»˜è®¤é…ç½®ï¼š
- è¾“å…¥: `input.png`
- Prompt: "Change the rabbit's color to purple..."
- è¾“å‡º: `outputs/output_merged_YYYYMMDD_HHMMSS.png`

---

### **è‡ªå®šä¹‰è¾“å…¥å›¾ç‰‡**

```bash
python 4_use_merged_model.py --input my_photo.jpg
# æˆ–ç®€å†™
python 4_use_merged_model.py -i my_photo.jpg
```

---

### **è‡ªå®šä¹‰ç¼–è¾‘æŒ‡ä»¤**

```bash
python 4_use_merged_model.py --prompt "Make the background blue"
# æˆ–ç®€å†™
python 4_use_merged_model.py -p "Add sunglasses to the person"
```

---

### **åŒæ—¶è‡ªå®šä¹‰è¾“å…¥å’Œ prompt**

```bash
python 4_use_merged_model.py \
    --input my_image.png \
    --prompt "Change the rabbit's color to purple"
```

æˆ–ä½¿ç”¨çŸ­å‚æ•°ï¼š
```bash
python 4_use_merged_model.py -i photo.jpg -p "Make it purple"
```

---

### **è‡ªå®šä¹‰è¾“å‡ºç›®å½•**

```bash
python 4_use_merged_model.py \
    -i input.png \
    -p "Add a hat" \
    -o results  # ä¿å­˜åˆ° results/ æ–‡ä»¶å¤¹
```

---

### **è°ƒæ•´æ¨ç†å‚æ•°**

```bash
python 4_use_merged_model.py \
    -i image.png \
    -p "Change style to anime" \
    -s 8 \      # æ¨ç†æ­¥æ•°ï¼ˆé»˜è®¤4ï¼‰
    -c 1.5      # CFG scaleï¼ˆé»˜è®¤1.0ï¼‰
```

---

## ğŸ“Š æ‰€æœ‰å‚æ•°è¯´æ˜

| å‚æ•° | çŸ­å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| `--input` | `-i` | `input.png` | è¾“å…¥å›¾ç‰‡è·¯å¾„ |
| `--prompt` | `-p` | (é»˜è®¤ prompt) | ç¼–è¾‘æŒ‡ä»¤ |
| `--output_dir` | `-o` | `outputs` | è¾“å‡ºç›®å½• |
| `--steps` | `-s` | `4` | æ¨ç†æ­¥æ•° |
| `--cfg` | `-c` | `1.0` | CFG Scale |
| `--model_path` | `-m` | `./models/...` | èåˆæ¨¡å‹è·¯å¾„ |

---

## ğŸ’¡ å®ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ‰¹é‡å¤„ç†ä¸åŒå›¾ç‰‡
```bash
python 4_use_merged_model.py -i image1.png -p "Add rainbow" -o batch1
python 4_use_merged_model.py -i image2.png -p "Make vintage" -o batch2
python 4_use_merged_model.py -i image3.png -p "Add snow" -o batch3
```

### ç¤ºä¾‹2ï¼šåŒä¸€å›¾ç‰‡ä¸åŒ prompt
```bash
python 4_use_merged_model.py -p "Make it purple"
python 4_use_merged_model.py -p "Add a hat"
python 4_use_merged_model.py -p "Change background to sunset"
```

### ç¤ºä¾‹3ï¼šä¸­æ–‡ prompt
```bash
python 4_use_merged_model.py -p "æŠŠå…”å­å˜æˆç´«è‰²"
python 4_use_merged_model.py -p "æ·»åŠ ä¸€é¡¶å¸½å­"
```

### ç¤ºä¾‹4ï¼šè°ƒæ•´ CFG å¼ºåº¦
```bash
python 4_use_merged_model.py -p "Make dramatic" -c 0.5  # å¼±å¼•å¯¼
python 4_use_merged_model.py -p "Make dramatic" -c 1.0  # æ ‡å‡†ï¼ˆæ¨èï¼‰
python 4_use_merged_model.py -p "Make dramatic" -c 2.0  # å¼ºå¼•å¯¼
```

---

## ğŸ” æŸ¥çœ‹å¸®åŠ©

```bash
python 4_use_merged_model.py --help
```

è¾“å‡ºï¼š
```
usage: 4_use_merged_model.py [-h] [--input INPUT] [--prompt PROMPT]
                              [--output_dir OUTPUT_DIR] [--steps STEPS]
                              [--cfg CFG] [--model_path MODEL_PATH]

ä½¿ç”¨èåˆåçš„ Qwen-Image-Edit Lightning æ¨¡å‹

optional arguments:
  -h, --help            show this help message and exit
  --input INPUT, -i INPUT
                        è¾“å…¥å›¾ç‰‡è·¯å¾„ (é»˜è®¤: input.png)
  --prompt PROMPT, -p PROMPT
                        ç¼–è¾‘æŒ‡ä»¤
  --output_dir OUTPUT_DIR, -o OUTPUT_DIR
                        è¾“å‡ºç›®å½• (é»˜è®¤: outputs)
  --steps STEPS, -s STEPS
                        æ¨ç†æ­¥æ•° (é»˜è®¤: 4, Lightning æ¨è)
  --cfg CFG, -c CFG     CFG Scale (é»˜è®¤: 1.0, Lightning æ¨è)
  --model_path MODEL_PATH, -m MODEL_PATH
                        èåˆæ¨¡å‹è·¯å¾„
```

---

## âš¡ æ€§èƒ½å¯¹æ¯”

| è„šæœ¬ | åŠ è½½æ—¶é—´ | æ¨ç†æ—¶é—´ | æ€»æ—¶é—´ |
|------|---------|---------|--------|
| `2_load_and_inference_lightning.py` | ~30ç§’ | ~5ç§’ | **~35ç§’** |
| `4_use_merged_model.py` | **~20ç§’** | ~5ç§’ | **~25ç§’** âš¡ |

èåˆç‰ˆæœ¬**èŠ‚çœçº¦10ç§’**åŠ è½½æ—¶é—´ï¼

---

## ğŸ¯ æ¨èä½¿ç”¨åœºæ™¯

### ä½¿ç”¨ 2_load_and_inference_lightning.py
- é¦–æ¬¡è¿è¡Œ
- è¿˜æ²¡èåˆ LoRA
- æµ‹è¯•ä¸åŒçš„ LoRA ç‰ˆæœ¬

### ä½¿ç”¨ 4_use_merged_model.pyï¼ˆèåˆåï¼‰
- âœ… å·²èåˆ LoRA
- âœ… é¢‘ç¹è¿è¡Œæ¨ç†
- âœ… æ‰¹é‡å¤„ç†
- âœ… ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ”„ å·¥ä½œæµç¨‹

```
é¦–æ¬¡ä½¿ç”¨:
1. python 2_load_and_inference_lightning.py  (åŠ è½½ LoRA)
2. python 3_merge_lora_to_weights.py         (èåˆ LoRA)

åç»­ä½¿ç”¨:
3. python 4_use_merged_model.py              (ç›´æ¥ä½¿ç”¨èåˆæ¨¡å‹)
   â†‘ æ›´å¿«ï¼Œæ¨è
```

